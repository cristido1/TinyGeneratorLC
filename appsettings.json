{
  "LlamaCpp": {
    "Root": "C:\\llama.cpp.13.1",
    "Models": "C:\\llama.cpp.13.1\\models",
    "ServerExe": "C:\\llama.cpp.13.1\\llama-server.exe",
    "Host": "127.0.0.1",
    "Port": 11436,
    "RestartPolicy": "kill",
    "GpuLayers": 0,
    "Device": "CUDA0",
    "CudaBinPath": "C:\\llama.cpp.13.1;C:\\Program Files\\NVIDIA GPU Computing Toolkit\\CUDA\\v12.4\\bin"
  },
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "AllowedHosts": "*",
  "AudioCraft": {
    "ForceCpu": false
  },
  "AudioMix": {
    "MusicVolume": 3,
    "BackgroundSoundsVolume": 0,
    "FxSourdsVolume": 6,
    "VoiceVolume": 7
  },
  "Serie": {
    "Bible": {
      "MaxAttempts": 3,
      "RetryDelaySeconds": 2,
      "DiagnoseOnFinalFailure": true
    },
    "Characters": {
      "MaxAttempts": 3,
      "RetryDelaySeconds": 2,
      "DiagnoseOnFinalFailure": true
    },
    "Episodes": {
      "MaxAttempts": 3,
      "RetryDelaySeconds": 2,
      "DiagnoseOnFinalFailure": true
    },
    "Validator": {
      "MaxAttempts": 3,
      "RetryDelaySeconds": 2,
      "DiagnoseOnFinalFailure": true
    }
  },
  "Debug": {
    "EnableOutboundGeneration": false
  },
  "Database": {
    "EnableEfMigrations": false,
    "EnableManualMigrations": false
  },
  "Commands": {
    "Policies": {
      "Default": {
        "MaxAttempts": 3,
        "RetryDelayBaseSeconds": 2,
        "RetryDelayMaxSeconds": 30,
        "ExponentialBackoff": true,
        "RetryOnFailureResult": false,
        "RetryOnException": true
      },
      "Commands": {
        "BatchSummarizeStories": {
          "MaxAttempts": 1
        },
        "SummarizeStory": {
          "MaxAttempts": 1
        },
        "TransformStoryRawToTagged": {
          "MaxAttempts": 1
        },
        "ExecuteMultiStepTask": {
          "MaxAttempts": 1
        },
        "StartMultiStepStory": {
          "MaxAttempts": 1
        },
        "FullStoryPipeline": {
          "MaxAttempts": 1
        },
        "full_story_pipeline": {
          "MaxAttempts": 1
        },
        "GenerateSeriesEpisode": {
          "MaxAttempts": 3
        },
        "series_episode": {
          "MaxAttempts": 1
        },
        "story_multi_step": {
          "MaxAttempts": 1
        },
        "GenerateNextChunk": {
          "MaxAttempts": 2,
          "RetryDelayBaseSeconds": 2,
          "RetryOnException": true
        },
        "StateDrivenNextChunk": {
          "MaxAttempts": 2,
          "RetryDelayBaseSeconds": 2,
          "RetryOnException": true
        },
        "StateDrivenEpisodeAuto": {
          "MaxAttempts": 2,
          "RetryDelayBaseSeconds": 2,
          "RetryOnException": true
        },
        "state_driven_series_episode": {
          "MaxAttempts": 1
        },
        "state_driven_series_episode_auto": {
          "MaxAttempts": 1
        },
        "state_driven_next_chunk": {
          "MaxAttempts": 2,
          "RetryDelayBaseSeconds": 2,
          "RetryOnException": true
        },
        "bulk_evaluate": {
          "MaxAttempts": 3
        },
        "bulk_evaluate_story": {
          "MaxAttempts": 3
        },
        "bulk_evaluate_coherence": {
          "MaxAttempts": 3
        },
        "evaluate_coherence": {
          "MaxAttempts": 3
        },
        "evaluate_action_pacing": {
          "MaxAttempts": 3
        },
        "clone_revised_story": {
          "MaxAttempts": 1
        },
        "test_tts_schema": {
          "MaxAttempts": 1
        },
        "mix_final_audio": {
          "MaxAttempts": 1
        },
        "prepare_tts_schema": {
          "MaxAttempts": 1
        },
        "normalize_characters": {
          "MaxAttempts": 1
        },
        "normalize_sentiments": {
          "MaxAttempts": 1
        },
        "delete_final_mix": {
          "MaxAttempts": 1
        },
        "delete_music": {
          "MaxAttempts": 1
        },
        "delete_fx": {
          "MaxAttempts": 1
        },
        "delete_ambience": {
          "MaxAttempts": 1
        },
        "delete_tts": {
          "MaxAttempts": 1
        },
        "delete_story_tagged": {
          "MaxAttempts": 1
        },
        "add_voice_tags_to_story": {
          "MaxAttempts": 3
        },
        "regen_ambient_tags": {
          "MaxAttempts": 3
        },
        "regen_fx_tags": {
          "MaxAttempts": 3
        },
        "regen_music_tags": {
          "MaxAttempts": 3
        },
        "advance_status": {
          "MaxAttempts": 1
        },
        "add_ambient_tags_to_story": {
          "MaxAttempts": 3
        },
        "add_fx_tags_to_story": {
          "MaxAttempts": 3
        },
        "add_music_tags_to_story": {
          "MaxAttempts": 3
        },
        "generate_ambience_audio": {
          "MaxAttempts": 1
        },
        "generate_fx_audio": {
          "MaxAttempts": 1
        },
        "generate_music": {
          "MaxAttempts": 1
        },
        "generate_tts_audio": {
          "MaxAttempts": 1
        },
        "generate_tts_schema": {
          "MaxAttempts": 1
        },
        "assign_voices": {
          "MaxAttempts": 1
        },
        "revise_story": {
          "MaxAttempts": 1
        },
        "evaluate_story": {
          "MaxAttempts": 3
        },
        "generate_new_serie": {
          "MaxAttempts": 1
        },
        "generate_character_images": {
          "MaxAttempts": 1
        },
        "generate_character_image": {
          "MaxAttempts": 1
        },
        "log_analyzer": {
          "MaxAttempts": 1
        },
        "memory_embedding_worker": {
          "MaxAttempts": 1
        },
        "update_model_stats": {
          "MaxAttempts": 1
        },
        "auto_idle_attempt": {
          "MaxAttempts": 1
        },
        "test_story_evaluation": {
          "MaxAttempts": 1
        },
        "scan_audio_masters": {
          "MaxAttempts": 1
        },
        "state_delta_builder": {
          "MaxAttempts": 1
        },
        "continuity_validator": {
          "MaxAttempts": 3
        },
        "state_updater": {
          "MaxAttempts": 1
        },
        "state_compressor": {
          "MaxAttempts": 1
        },
        "recap_builder": {
          "MaxAttempts": 1
        }
      }
    },
    "ResponseValidation": {
      "Enabled": true,
      "MaxRetries": 2,
      "AskFailureReasonOnFinalFailure": true,
      "EnableFallback": true,
      "EnableCheckerByDefault": true,
      "SkipRoles": [
        "response_checker",
        "log_analyzer"
      ],
      "CommandPolicies": {
        "create_story": {
          "EnableChecker": true,
          "MaxRetries": 2,
          "AskFailureReasonOnFinalFailure": true,
          "RuleIds": [
            1,
            2,
            3,
            4
          ]
        },
        "story/add_voice_tags_to_story": {
          "EnableChecker": true,
          "MaxRetries": 3,
          "AskFailureReasonOnFinalFailure": false,
          "RuleIds": [
            3
          ]
        },
        "story/add_ambient_tags_to_story": {
          "EnableChecker": true,
          "MaxRetries": 3,
          "AskFailureReasonOnFinalFailure": false,
          "RuleIds": [
            3
          ]
        },
        "response_checker_validation": {
          "EnableChecker": false,
          "MaxRetries": 0,
          "AskFailureReasonOnFinalFailure": false
        },
        "response_checker_tool_reminder": {
          "EnableChecker": false,
          "MaxRetries": 0,
          "AskFailureReasonOnFinalFailure": false
        },
        "json_score": {
          "EnableChecker": false,
          "MaxRetries": 0,
          "AskFailureReasonOnFinalFailure": false
        },
        "test_base": {
          "EnableChecker": false,
          "MaxRetries": 0,
          "AskFailureReasonOnFinalFailure": false
        },
        "test_music": {
          "EnableChecker": false,
          "MaxRetries": 0,
          "AskFailureReasonOnFinalFailure": false
        },
        "thread_chat": {
          "EnableChecker": false,
          "MaxRetries": 3,
          "AskFailureReasonOnFinalFailure": false
        }
      },
      "Rules": [
        {
          "Id": 1,
          "Text": "Non fare domande all\u0027utente e non chiedere chiarimenti."
        },
        {
          "Id": 2,
          "Text": "Non anticipare step futuri o output non richiesti."
        },
        {
          "Id": 3,
          "Text": "Rispetta rigorosamente il formato richiesto (se presente)."
        },
        {
          "Id": 4,
          "Text": "Risposta completa: non troncare e non lasciare TODO."
        }
      ]
    },
    "Tuning": {
      "AmbientExpert": {
        "AutolaunchNextCommand": true,
        "MinTokensPerChunk": 1000,
        "MaxTokensPerChunk": 2000,
        "TargetTokensPerChunk": 1500,
        "OverlapTokens": 150,
        "MaxAttemptsPerChunk": 4,
        "MinAmbientTagsPerChunkRequirement": 2,
        "DiagnoseOnFinalFailure": true,
        "RetryDelayBaseSeconds": 2
      },
      "FxExpert": {
        "AutolaunchNextCommand": true,
        "DefaultTargetTokensPerChunk": 900,
        "DefaultMaxTokensPerChunk": 1400,
        "MaxAttemptsPerChunk": 4,
        "MinFxTagsPerChunk": 1,
        "DiagnoseOnFinalFailure": true,
        "RetryDelayBaseSeconds": 2
      },
      "MusicExpert": {
        "AutolaunchNextCommand": true,
        "MinTokensPerChunk": 1000,
        "MaxTokensPerChunk": 2000,
        "TargetTokensPerChunk": 1500,
        "OverlapTokens": 150,
        "MaxAttemptsPerChunk": 4,
        "MaxMusicTagsPerChunkRequirement": 3,
        "MinMusicTagsPerChunkRequirement": 1,
        "DiagnoseOnFinalFailure": true,
        "RetryDelayBaseSeconds": 2
      },
      "TransformStoryRawToTagged": {
        "AutolaunchNextCommand": true,
        "MinTokensPerChunk": 1000,
        "MaxTokensPerChunk": 2000,
        "TargetTokensPerChunk": 1500,
        "OverlapTokens": 150,
        "MaxAttemptsPerChunk": 4,
        "FormatterV2CorrectionRetries": 3,
        "MaxOverlapChars": 8000,
        "MinTagsPerChunkRequirement": 3,
        "RetryDelayBaseSeconds": 2
      },
      "GenerateNextChunk": {
        "ContextTailChars": 800,
        "MaxAttempts": 4
      },
      "PlannedStory": {
        "BeatMaxRetries": 4,
        "MinBeatLengthChars": 500,
        "RetryDelayMilliseconds": 1000
      },
      "FullStoryPipeline": {
        "AudioPipelineTotalSteps": 9
      }
    }
  },
  "ToolCalling": {
    "Enabled": false
  },
  "OpenAI": {
    "endpoint": "https://api.openai.com/v1/responses",
    "NoTemperatureModels": [
      "gpt-5-nano",
      "gpt-4.1-nano",
      "gpt-5-mini",
      "gpt-4.1-mini"
    ],
    "NoRepeatLastNModels": [
      "gpt-5-nano",
      "gpt-4.1-nano",
      "gpt-5-mini",
      "gpt-4.1-mini"
    ],
    "NoNumPredictModels": [
      "gpt-5-nano",
      "gpt-4.1-nano",
      "gpt-5-mini",
      "gpt-4.1-mini"
    ],
    "NoRepeatPenaltyModels": [
      "gpt-5-nano",
      "gpt-4.1-nano",
      "gpt-5-mini",
      "gpt-4.1-mini"
    ],
    "NoTopPModels": [
      "gpt-5-nano",
      "gpt-4.1-nano",
      "gpt-5-mini",
      "gpt-4.1-mini"
    ],
    "NoFrequencyPenaltyModels": [
      "gpt-5-nano",
      "gpt-4.1-nano",
      "gpt-5-mini",
      "gpt-4.1-mini"
    ],
    "NoMaxTokensModels": [
      "gpt-5-nano",
      "gpt-4.1-nano",
      "gpt-5-mini",
      "gpt-4.1-mini"
    ],
    "NoTopKModels": [
      "gpt-5-nano",
      "gpt-4.1-nano",
      "gpt-5-mini",
      "gpt-4.1-mini"
    ]
  },
  "Ollama": {
    "endpoint": "http://localhost:11434"
  },
  "Memory": {
    "Embeddings": {
      "Model": "nomic-embed-text:latest",
      "BackfillBatchSize": 4,
      "RequestTimeoutSeconds": 120,
      "EmbeddingDimension": 768,
      "SqliteVecExtensionPath": ""
    }
  },
  "AppLog": {
    "LogRequestResponse": true,
    "OtherLogs": false,
    "LogToolResponses": false
  },
  "CommandDispatcher": {
    "MaxParallelCommands": 1
  },
  "TtsSchemaGeneration": {
    "PhraseGapSeconds": 2,
    "AutolaunchNextCommand": true,
    "CharacterExtractionMaxAttempts": 3
  },
  "StoryTaggingPipeline": {
    "TaggedVoice": {
      "AutolaunchNextCommand": true,
      "EnableDialogTagCheck": true,
      "EnableEmotionTagCheck": true,
      "MinDistinctCharacters": 2
    },
    "TaggedAmbient": {
      "AutolaunchNextCommand": true,
      "EnableAmbientTagCheck": true,
      "MinAmbientTagDensity": 0.05
    },
    "TaggedFx": {
      "AutolaunchNextCommand": true,
      "EnableFxTagCheck": true,
      "MinFxTagCount": 3
    },
    "Tagged": {
      "AutolaunchNextCommand": true,
      "EnableMusicTagCheck": true,
      "MinMusicTagCount": 1
    }
  },
  "StateDrivenStoryGeneration": {
    "EnableDegenerativePunctuationCheck": true,
    "MaxDegenerativePunctuationMatches": 2,
    "EnableDialogueLoopCheck": true,
    "EnableEmotionalLoopCheck": true,
    "EnableActionPresenceCheck": true,
    "EnableSimilarSentenceRepetitionCheck": true,
    "SimilarSentenceSimilarityThreshold": 0.8,
    "SimilarSentenceRepeatLimit": 2,
    "EnableParagraphActionGapCheck": true,
    "ParagraphActionGapThreshold": 2,
    "EnableHistoricalLoopDetection": true,
    "HistoricalLoopSimilarityThreshold": 0.85,
    "HistoricalLoopRepeatThreshold": 6,
    "HistoricalLoopRepeatRatioThreshold": 0.5,
    "HistoricalLoopHistorySentenceCount": 5
  },
  "NarratorVoice": {
    "DefaultVoiceId": "luca_brasi"
  },
  "AudioGeneration": {
    "Tts": {
      "AutolaunchNextCommand": true
    },
    "Ambience": {
      "AutolaunchNextCommand": true
    },
    "Fx": {
      "AutolaunchNextCommand": true
    }
  },
  "AutomaticOperations": {
    "Enabled": false,
    "IdleSeconds": 10,
    "ReviseAndEvaluate": {
      "Enabled": true,
      "Priority": 1
    },
    "EvaluateRevised": {
      "Enabled": true,
      "Priority": 2
    },
    "AutoDeleteLowRated": {
      "Enabled": false,
      "Priority": 3,
      "MinAverageScore": 50,
      "MinEvaluations": 2
    },
    "UpdateModelStats": {
      "Enabled": true,
      "Priority": 5
    },
    "AutoCompleteAudioPipeline": {
      "Enabled": true,
      "Priority": 8,
      "MinAverageScore": 60
    },
    "AutoStateDrivenSeriesEpisode": {
      "Enabled": true,
      "Priority": 7,
      "IntervalMinutes": 20,
      "TargetMinutes": 20,
      "WordsPerMinute": 150,
      "WriterAgentId": 52
    }
  }
}