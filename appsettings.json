{
  "LlamaCpp": {
    "Root": "C:\\llama.cpp.13.1",
    "Models": "C:\\llama.cpp.13.1\\models",
    "ServerExe": "C:\\llama.cpp.13.1\\llama-server.exe",
    "Host": "127.0.0.1",
    "Port": 11436,
    "RestartPolicy": "kill",
    "GpuLayers": 0,
    "Device": "CUDA0",
    "CudaBinPath": "C:\\llama.cpp.13.1;C:\\Program Files\\NVIDIA GPU Computing Toolkit\\CUDA\\v12.4\\bin"
  },
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "AllowedHosts": "*",
  "AudioCraft": {
    "ForceCpu": false
  },
  "AudioMix": {
    "MusicVolume": 3,
    "BackgroundSoundsVolume": 0,
    "FxSourdsVolume": 6,
    "VoiceVolume": 7
  },
  "Startup": {
    "Timeouts": {
      "LlamaServerKillMs": 3000,
      "AudioCraftHealthCheckIntervalMs": 1000,
      "AudioCraftMaxStartupWaitMs": 30000,
      "TtsSeedTimeoutSeconds": 10,
      "DefaultProcessKillMs": 5000
    },
    "AudioCraft": {
      "HealthEndpoint": "http://localhost:8003/health",
      "PowerShellScript": "start_audiocraft.ps1",
      "PythonScript": "audiocraft_server.py"
    }
  },
  "Serie": {
    "Bible": {
      "MaxAttempts": 3,
      "RetryDelaySeconds": 2,
      "TimeoutSec": 60,
      "DiagnoseOnFinalFailure": true,
      "UseResponseChecker": false,
      "ExplainAfterAttempt": 2
    },
    "Characters": {
      "MaxAttempts": 3,
      "RetryDelaySeconds": 2,
      "TimeoutSec": 60,
      "DiagnoseOnFinalFailure": true,
      "UseResponseChecker": false,
      "ExplainAfterAttempt": 2
    },
    "Episodes": {
      "MaxAttempts": 3,
      "RetryDelaySeconds": 2,
      "TimeoutSec": 400,
      "DiagnoseOnFinalFailure": true,
      "UseResponseChecker": false,
      "ExplainAfterAttempt": 2
    },
    "Validator": {
      "MaxAttempts": 3,
      "RetryDelaySeconds": 2,
      "TimeoutSec": 120,
      "DiagnoseOnFinalFailure": true,
      "UseResponseChecker": false,
      "ExplainAfterAttempt": 2
    }
  },
  "Debug": {
    "EnableOutboundGeneration": false
  },
  "Database": {
    "EnableEfMigrations": false,
    "EnableManualMigrations": false
  },
  "Commands": {
    "Defaults": {
      "Policy": {
        "TimeoutSec": 600,
        "MaxAttempts": 3,
        "RetryDelayBaseSeconds": 2,
        "RetryDelayMaxSeconds": 30,
        "ExponentialBackoff": true,
        "RetryOnFailureResult": false,
        "RetryOnException": true
      },
      "ResponseValidation": {
        "Enabled": true,
        "MaxRetries": 2,
        "AskFailureReasonOnFinalFailure": true,
        "ExplainAfterAttempt": 2,
        "EnableFallback": true,
        "EnableCheckerByDefault": true,
        "CheckerTimeoutSec": 60,
        "EnableDeterministicValidation": true,
        "SkipRoles": [
          "response_checker",
          "log_analyzer"
        ],
        "Rules": [
          {
            "Id": 1,
            "Text": "Non fare domande all\u0027utente e non chiedere chiarimenti."
          },
          {
            "Id": 2,
            "Text": "Non anticipare step futuri o output non richiesti."
          },
          {
            "Id": 3,
            "Text": "Rispetta rigorosamente il formato richiesto (se presente)."
          },
          {
            "Id": 4,
            "Text": "Risposta completa: non troncare e non lasciare TODO."
          }
        ]
      }
    },
    "ByCommand": {
      "batch_summarize_stories": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "summarize_story": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "transform_story_raw_to_tagged": {
        "MaxAttempts": 1,
        "TimeoutSec": 400,
        "AutolaunchNextCommand": true,
        "MinTokensPerChunk": 1000,
        "MaxTokensPerChunk": 2000,
        "TargetTokensPerChunk": 1500,
        "OverlapTokens": 150,
        "MaxAttemptsPerChunk": 4,
        "FormatterV2CorrectionRetries": 3,
        "MaxOverlapChars": 8000,
        "MinTagsPerChunkRequirement": 3,
        "RetryDelayBaseSeconds": 2,
        "EnableChecker": true
      },
      "execute_multi_step_task": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "start_multi_step_story": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "full_story_pipeline": {
        "MaxAttempts": 1,
        "TimeoutSec": 400,
        "AudioPipelineTotalSteps": 9,
        "EnableChecker": true
      },
      "generate_series_episode": {
        "MaxAttempts": 3,
        "TimeoutSec": 400,
        "EnableChecker": true
      },
      "story_multi_step": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "generate_next_chunk": {
        "TimeoutSec": 400,
        "MaxAttempts": 4,
        "RetryDelayBaseSeconds": 2,
        "RetryOnException": true,
        "ContextTailChars": 800,
        "EnableChecker": true
      },
      "state_driven_next_chunk": {
        "TimeoutSec": 400,
        "MaxAttempts": 2,
        "RetryDelayBaseSeconds": 2,
        "RetryOnException": true,
        "EnableChecker": true
      },
      "state_driven_episode_auto": {
        "TimeoutSec": 400,
        "MaxAttempts": 2,
        "RetryDelayBaseSeconds": 2,
        "RetryOnException": true,
        "EnableChecker": true
      },
      "state_driven_series_episode": {
        "MaxAttempts": 1,
        "TimeoutSec": 400,
        "EnableChecker": true
      },
      "bulk_evaluate": {
        "MaxAttempts": 3,
        "EnableChecker": true
      },
      "bulk_evaluate_story": {
        "MaxAttempts": 3,
        "EnableChecker": true
      },
      "bulk_evaluate_coherence": {
        "MaxAttempts": 3,
        "EnableChecker": true
      },
      "evaluate_coherence": {
        "MaxAttempts": 3,
        "EnableChecker": true
      },
      "evaluate_action_pacing": {
        "MaxAttempts": 3,
        "EnableChecker": true
      },
      "clone_revised_story": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "test_tts_schema": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "mix_final_audio": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "prepare_tts_schema": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "normalize_characters": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "normalize_sentiments": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "delete_final_mix": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "delete_music": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "delete_fx": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "delete_ambience": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "delete_tts": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "delete_story_tagged": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "add_voice_tags_to_story": {
        "MaxAttempts": 3,
        "TimeoutSec": 60,
        "EnableChecker": true
      },
      "regen_ambient_tags": {
        "MaxAttempts": 3,
        "EnableChecker": true
      },
      "regen_fx_tags": {
        "MaxAttempts": 3,
        "EnableChecker": true
      },
      "regen_music_tags": {
        "MaxAttempts": 3,
        "EnableChecker": true
      },
      "advance_status": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "add_ambient_tags_to_story": {
        "TimeoutSec": 90,
        "AutolaunchNextCommand": true,
        "RequestTimeoutSeconds": 45,
        "MinTokensPerChunk": 1000,
        "MaxTokensPerChunk": 2000,
        "TargetTokensPerChunk": 1500,
        "OverlapTokens": 150,
        "MaxAttemptsPerChunk": 4,
        "MinAmbientTagsPerChunkRequirement": 1,
        "DiagnoseOnFinalFailure": true,
        "RetryDelayBaseSeconds": 2,
        "EnableChecker": true
      },
      "add_fx_tags_to_story": {
        "TimeoutSec": 30,
        "AutolaunchNextCommand": true,
        "DefaultTargetTokensPerChunk": 900,
        "DefaultMaxTokensPerChunk": 1400,
        "MaxAttemptsPerChunk": 4,
        "MinFxTagsPerChunk": 1,
        "DiagnoseOnFinalFailure": true,
        "RetryDelayBaseSeconds": 2,
        "EnableChecker": true
      },
      "add_music_tags_to_story": {
        "TimeoutSec": 30,
        "AutolaunchNextCommand": true,
        "MinTokensPerChunk": 1000,
        "MaxTokensPerChunk": 2000,
        "TargetTokensPerChunk": 1500,
        "OverlapTokens": 150,
        "MaxAttemptsPerChunk": 4,
        "MaxMusicTagsPerChunkRequirement": 3,
        "MinMusicTagsPerChunkRequirement": 1,
        "DiagnoseOnFinalFailure": true,
        "RetryDelayBaseSeconds": 2,
        "EnableChecker": true
      },
      "generate_ambience_audio": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "generate_fx_audio": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "generate_music": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "generate_tts_audio": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "generate_tts_schema": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "assign_voices": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "revise_story": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "evaluate_story": {
        "MaxAttempts": 3,
        "EnableChecker": true
      },
      "generate_new_serie": {
        "MaxAttempts": 3,
        "TimeoutSec": 400,
        "EnableChecker": true,
        "Tuning": {
          "Bible": {
            "MaxAttempts": 3,
            "RetryDelaySeconds": 2,
            "TimeoutSec": 60,
            "DiagnoseOnFinalFailure": true,
            "UseResponseChecker": false,
            "ExplainAfterAttempt": 2
          },
          "Characters": {
            "MaxAttempts": 3,
            "RetryDelaySeconds": 2,
            "TimeoutSec": 60,
            "DiagnoseOnFinalFailure": true,
            "UseResponseChecker": false,
            "ExplainAfterAttempt": 2
          },
          "Episodes": {
            "MaxAttempts": 3,
            "RetryDelaySeconds": 2,
            "TimeoutSec": 400,
            "DiagnoseOnFinalFailure": true,
            "UseResponseChecker": false,
            "ExplainAfterAttempt": 2
          },
          "Validator": {
            "MaxAttempts": 3,
            "RetryDelaySeconds": 2,
            "TimeoutSec": 120,
            "DiagnoseOnFinalFailure": true,
            "UseResponseChecker": false,
            "ExplainAfterAttempt": 2
          },
          "Validation": {
            "EnableBibleValidation": true,
            "EnableCharactersValidation": true,
            "EnableSeasonValidation": true,
            "EnableEpisodeStructureValidation": true,
            "RequireValidationOkTag": true,
            "ValidateCharacterReferences": true,
            "ValidateDuplicateEpisodeNumbers": true,
            "MinEpisodeBeats": 3
          }
        }
      },
      "generate_character_images": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "generate_character_image": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "log_analyzer": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "memory_embedding_worker": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "update_model_stats": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "auto_idle_attempt": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "test_story_evaluation": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "scan_audio_masters": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "state_delta_builder": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "continuity_validator": {
        "MaxAttempts": 3,
        "EnableChecker": true
      },
      "state_updater": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "state_compressor": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "recap_builder": {
        "MaxAttempts": 1,
        "EnableChecker": true
      },
      "create_story": {
        "EnableChecker": true,
        "MaxRetries": 2,
        "AskFailureReasonOnFinalFailure": true,
        "RuleIds": [
          1,
          2,
          3,
          4
        ]
      },
      "story/add_voice_tags_to_story": {
        "EnableChecker": true,
        "MaxRetries": 3,
        "AskFailureReasonOnFinalFailure": true,
        "RuleIds": [
          3
        ]
      },
      "story/add_ambient_tags_to_story": {
        "EnableChecker": true,
        "MaxRetries": 3,
        "AskFailureReasonOnFinalFailure": true,
        "RuleIds": [
          3
        ]
      },
      "response_checker_validation": {
        "EnableChecker": false,
        "MaxRetries": 0,
        "AskFailureReasonOnFinalFailure": false
      },
      "response_checker_tool_reminder": {
        "EnableChecker": false,
        "MaxRetries": 0,
        "AskFailureReasonOnFinalFailure": false
      },
      "json_score": {
        "EnableChecker": false,
        "MaxRetries": 1,
        "AskFailureReasonOnFinalFailure": true
      },
      "instruction_score": {
        "QuestionTimeoutSeconds": 10,
        "TopP": 0.1,
        "EnableChecker": false,
        "MaxRetries": 0,
        "AskFailureReasonOnFinalFailure": true
      },
      "intelligence_test": {
        "timeoutSec": 15,
        "QuestionTimeoutSeconds": 15,
        "TopP": 0.1,
        "EnableChecker": false,
        "MaxRetries": 0,
        "AskFailureReasonOnFinalFailure": true
      },
      "test_base": {
        "EnableChecker": false,
        "MaxRetries": 0,
        "AskFailureReasonOnFinalFailure": true
      },
      "test_music": {
        "EnableChecker": false,
        "MaxRetries": 0,
        "AskFailureReasonOnFinalFailure": true
      },
      "thread_chat": {
        "EnableChecker": false,
        "MaxRetries": 3,
        "AskFailureReasonOnFinalFailure": true
      },
      "planned_story": {
        "TimeoutSec": 400,
        "BeatMaxRetries": 4,
        "MinBeatLengthChars": 500,
        "RetryDelayMilliseconds": 1000,
        "EnableChecker": true
      },
      "AmbientExpert": {
        "TimeoutSec": 400,
        "EnableChecker": true
      },
      "FxExpert": {
        "TimeoutSec": 400,
        "EnableChecker": true
      },
      "MusicExpert": {
        "TimeoutSec": 400,
        "EnableChecker": true
      },
      "state_driven_series_episode_auto": {
        "TimeoutSec": 400,
        "EnableChecker": true
      },
      "TransformStoryRawToTagged": {
        "TimeoutSec": 400,
        "EnableChecker": true
      }
    }
  },
  "ToolCalling": {
    "Enabled": false
  },
  "OpenAI": {
    "endpoint": "https://api.openai.com/v1/responses",
    "NoTemperatureModels": [
      "gpt-5-nano",
      "gpt-4.1-nano",
      "gpt-5-mini",
      "gpt-4.1-mini"
    ],
    "NoRepeatLastNModels": [
      "gpt-5-nano",
      "gpt-4.1-nano",
      "gpt-5-mini",
      "gpt-4.1-mini"
    ],
    "NoNumPredictModels": [
      "gpt-5-nano",
      "gpt-4.1-nano",
      "gpt-5-mini",
      "gpt-4.1-mini"
    ],
    "NoRepeatPenaltyModels": [
      "gpt-5-nano",
      "gpt-4.1-nano",
      "gpt-5-mini",
      "gpt-4.1-mini"
    ],
    "NoTopPModels": [
      "gpt-5-nano",
      "gpt-4.1-nano",
      "gpt-5-mini",
      "gpt-4.1-mini"
    ],
    "NoFrequencyPenaltyModels": [
      "gpt-5-nano",
      "gpt-4.1-nano",
      "gpt-5-mini",
      "gpt-4.1-mini"
    ],
    "NoMaxTokensModels": [
      "gpt-5-nano",
      "gpt-4.1-nano",
      "gpt-5-mini",
      "gpt-4.1-mini"
    ],
    "NoTopKModels": [
      "gpt-5-nano",
      "gpt-4.1-nano",
      "gpt-5-mini",
      "gpt-4.1-mini"
    ]
  },
  "Ollama": {
    "endpoint": "http://localhost:11434"
  },
  "Memory": {
    "Embeddings": {
      "Model": "nomic-embed-text:latest",
      "BackfillBatchSize": 4,
      "RequestTimeoutSeconds": 120,
      "EmbeddingDimension": 768,
      "SqliteVecExtensionPath": ""
    }
  },
  "AppLog": {
    "LogRequestResponse": true,
    "OtherLogs": false,
    "LogToolResponses": false
  },
  "CommandDispatcher": {
    "MaxParallelCommands": 1
  },
  "TtsSchemaGeneration": {
    "PhraseGapSeconds": 2,
    "AutolaunchNextCommand": true,
    "CharacterExtractionMaxAttempts": 3
  },
  "StoryTaggingPipeline": {
    "TaggedVoice": {
      "AutolaunchNextCommand": true,
      "EnableDialogTagCheck": true,
      "EnableEmotionTagCheck": true,
      "MinDistinctCharacters": 2
    },
    "TaggedAmbient": {
      "AutolaunchNextCommand": true,
      "EnableAmbientTagCheck": true,
      "MinAmbientTagDensity": 0.05
    },
    "TaggedFx": {
      "AutolaunchNextCommand": true,
      "EnableFxTagCheck": true,
      "MinFxTagCount": 3
    },
    "Tagged": {
      "AutolaunchNextCommand": true,
      "EnableMusicTagCheck": true,
      "MinMusicTagCount": 1
    }
  },
  "StateDrivenStoryGeneration": {
    "EnableDegenerativePunctuationCheck": true,
    "MaxDegenerativePunctuationMatches": 2,
    "EnableDialogueLoopCheck": true,
    "EnableEmotionalLoopCheck": true,
    "EnableActionPresenceCheck": true,
    "EnableSimilarSentenceRepetitionCheck": true,
    "SimilarSentenceSimilarityThreshold": 0.8,
    "SimilarSentenceRepeatLimit": 2,
    "EnableParagraphActionGapCheck": true,
    "ParagraphActionGapThreshold": 2,
    "EnableHistoricalLoopDetection": true,
    "HistoricalLoopSimilarityThreshold": 0.85,
    "HistoricalLoopRepeatThreshold": 6,
    "HistoricalLoopRepeatRatioThreshold": 0.5,
    "HistoricalLoopHistorySentenceCount": 5
  },
  "NarratorVoice": {
    "DefaultVoiceId": "luca_brasi"
  },
  "AudioGeneration": {
    "Tts": {
      "AutolaunchNextCommand": true
    },
    "Ambience": {
      "AutolaunchNextCommand": true
    },
    "Fx": {
      "AutolaunchNextCommand": true
    }
  },
  "AutomaticOperations": {
    "Enabled": false,
    "IdleSeconds": 10,
    "ReviseAndEvaluate": {
      "Enabled": true,
      "Priority": 1
    },
    "EvaluateRevised": {
      "Enabled": true,
      "Priority": 2
    },
    "AutoDeleteLowRated": {
      "Enabled": false,
      "Priority": 3,
      "MinAverageScore": 50,
      "MinEvaluations": 2
    },
    "UpdateModelStats": {
      "Enabled": true,
      "Priority": 5
    },
    "AutoCompleteAudioPipeline": {
      "Enabled": true,
      "Priority": 8,
      "MinAverageScore": 60
    },
    "AutoStateDrivenSeriesEpisode": {
      "Enabled": true,
      "Priority": 7,
      "IntervalMinutes": 20,
      "TargetMinutes": 20,
      "WordsPerMinute": 150,
      "WriterAgentId": 52
    }
  }
}
