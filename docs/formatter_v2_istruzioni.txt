FORMATTER V2 – ISTRUZIONI OPERATIVE

OBIETTIVO
Implementare un algoritmo deterministico per l’assegnazione dei tag di parlato:
[PERSONAGGIO: Nome] [EMOZIONE: emozione]
garantendo che il testo originale NON venga mai modificato.

NOTA CHIAVE
- L’agente Formatter NON deve conoscere né produrre il tag [NARRATORE].
- Tutto ciò che non è parlato viene assegnato automaticamente a [NARRATORE] dal codice.
- Il codice inserisce [NARRATORE] nelle sezioni non-parlate e lo “riapre” quando un personaggio ha finito di parlare.

--------------------------------------------------
1. PRE-PROCESSING – SEGMENTAZIONE TESTO
--------------------------------------------------

1.1 Regola fondamentale
Il testo non deve essere alterato semanticamente.
La segmentazione serve solo a creare unità minime taggabili.

1.2 Regole di divisione in righe
Il testo va spezzato in nuove righe quando incontra:
- Punto (.) se non già seguito da a capo
- Virgola (,)
- Punto e virgola (;)
- Due punti (:)
- Virgolette doppie (" ")
- Virgolette caporali (« »)
- Apostrofi di dialogo ('), solo se indicano parlato
- Inizio o fine di dialogo implicito

La punteggiatura resta nella riga.
Non rimuovere né aggiungere caratteri.

--------------------------------------------------
2. NUMERAZIONE DELLE RIGHE
--------------------------------------------------

Ogni riga ottiene un ID progressivo a 3 cifre:
001, 002, 003 ...

Formato passato all’agente:

001 Con un ultimo sguardo all'ennesimo documento,
002 Luca premette il pulsante di invio.
003 «Non voglio più vederti»
004 disse a bassa voce.

L’ID NON fa parte del testo originale.

--------------------------------------------------
3. COMPITO DELL’AGENTE FORMATTER
--------------------------------------------------

L’agente deve:
- Analizzare ogni riga singolarmente
- Stabilire se è parlato (qualcuno sta parlando) oppure no
- Quando è parlato: estrarre Nome del personaggio + emozione
- Restituire SOLO mapping ID → TAG per le righe di parlato

L’agente NON deve:
- Riscrivere il testo
- Restituire il testo
- Commentare
- Spiegare
- Aggiungere contenuti

--------------------------------------------------
4. FORMATO DI RISPOSTA DELL’AGENTE
--------------------------------------------------

Esempio:

003 [PERSONAGGIO: Luca] [SENTIMENTO: rabbia]

003 [PERSONAGGIO: Luca] [EMOZIONE: rabbia]

Una riga per ID.
Ordine libero.
Solo ID + tag.

--------------------------------------------------
5. POST-PROCESSING (CODICE)
--------------------------------------------------

Per ogni riga originale:
- Se l’ID è presente nel mapping: usare il tag [PERSONAGGIO: ...] [EMOZIONE: ...]
- Se l’ID NON è presente nel mapping: assegnare automaticamente [NARRATORE]
- Inserire i tag solo quando cambia il “parlante” (tag a sezioni), e riaprire [NARRATORE] dopo i dialoghi
- NON modificare il testo originale (oltre all’aggiunta dei tag)

Poi:
- Rimuovere gli ID
- Ricostruire il testo continuo con i tag inseriti

--------------------------------------------------
6. PROMPT AGENTE FORMATTER (COPIABILE)
--------------------------------------------------

Sei un agente di classificazione.

Ti verranno fornite righe numerate.
Ogni riga è una porzione di testo originale.

COMPITO:
Indica SOLO le righe dove parla qualcuno (dialogo).
Per quelle righe, indica il personaggio e la sua emozione.

TAG POSSIBILI:
[PERSONAGGIO: Nome] [EMOZIONE: emozione]

REGOLE OBBLIGATORIE:
- NON riscrivere il testo
- NON restituire il testo
- NON spiegare
- NON commentare
- NON aggiungere contenuti
- Restituisci SOLO righe nel formato:
  ID TAG
- Restituisci SOLO le righe dove parla qualcuno (non tutte le righe)
- NON includere alcun altro tag oltre a PERSONAGGIO ed EMOZIONE

Esempio:
004 [PERSONAGGIO: Luca] [EMOZIONE: paura]

FINE FILE
